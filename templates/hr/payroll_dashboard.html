{% extends 'base.html' %}
{% load humanize %}

{% block title %}Quản lý Lương{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold text-dark">BẢNG LƯƠNG NHÂN SỰ</h4>
    <div class="d-flex gap-2">
        <form method="GET" class="d-flex gap-2">
            <input type="month" name="month" class="form-control" value="{{ selected_month }}" onchange="this.form.submit()">
        </form>
        <form method="POST">
            {% csrf_token %}
            <button class="btn btn-success fw-bold shadow-sm"><i class="bi bi-calculator me-2"></i>TÍNH LƯƠNG THÁNG NÀY</button>
        </form>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="card card-box bg-primary text-white p-3">
            <h6 class="text-white-50 small text-uppercase">Tổng thực chi</h6>
            <h3 class="fw-bold mb-0">{{ total_payout|intcomma }} đ</h3>
        </div>
    </div>
</div>

<div class="card card-box">
    <table class="table table-hover align-middle mb-0">
        <thead class="bg-light">
            <tr>
                <th class="ps-4">Nhân viên</th>
                <th class="text-end">Lương cứng</th>
                <th class="text-center">Công</th>
                <th class="text-end">Phụ cấp</th>
                <th class="text-end">Thưởng/Phạt</th>
                <th class="text-end pe-4 text-danger fw-bold">THỰC LĨNH</th>
            </tr>
        </thead>
        <tbody>
            {% for slip in slips %}
            <tr>
                <td class="ps-4 fw-bold">{{ slip.user.last_name }} {{ slip.user.first_name }}</td>
                <td class="text-end text-muted">{{ slip.base_salary_lock|intcomma }}</td>
                <td class="text-center fw-bold">{{ slip.actual_work_days }}</td>
                <td class="text-end">{{ slip.allowance_lock|intcomma }}</td>
                <td class="text-end">
                    {% if slip.bonus > 0 %}<span class="text-success">+{{ slip.bonus|intcomma }}</span><br>{% endif %}
                    {% if slip.deduction > 0 %}<span class="text-danger">-{{ slip.deduction|intcomma }}</span>{% endif %}
                </td>
                <td class="text-end pe-4 fw-bold text-danger fs-5">{{ slip.total_salary|intcomma }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="text-center py-4 text-muted">Chưa có dữ liệu lương tháng này. Hãy nhấn "TÍNH LƯƠNG".</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}